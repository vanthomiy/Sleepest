package com.doitstudio.sleepest_master.sleepcalculation.model.algorithm

import com.doitstudio.sleepest_master.storage.db.SleepApiRawDataEntity
import com.google.gson.Gson
import org.hamcrest.CoreMatchers.equalTo
import org.junit.Assert.*
import org.junit.Test

class SleepModelTest
{
    @Test
    fun defineModelWithListsTest() {

        var gson = Gson()

        //region assigments

        val awakeListFile = "[{\"timestampSeconds\":1617138720,\"confidence\":2,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617139620,\"confidence\":4,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617140100,\"confidence\":6,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617140580,\"confidence\":6,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617140940,\"confidence\":46,\"motion\":5,\"light\":3},{\"timestampSeconds\":1617141300,\"confidence\":3,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617141660,\"confidence\":7,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617142020,\"confidence\":5,\"motion\":6,\"light\":4},{\"timestampSeconds\":1617142380,\"confidence\":11,\"motion\":6,\"light\":6},{\"timestampSeconds\":1617142740,\"confidence\":4,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617143100,\"confidence\":1,\"motion\":6,\"light\":3},{\"timestampSeconds\":1617143460,\"confidence\":30,\"motion\":3,\"light\":3},{\"timestampSeconds\":1617143820,\"confidence\":50,\"motion\":1,\"light\":3},{\"timestampSeconds\":1617144180,\"confidence\":11,\"motion\":6,\"light\":2},{\"timestampSeconds\":1617144540,\"confidence\":12,\"motion\":5,\"light\":2},{\"timestampSeconds\":1617144900,\"confidence\":6,\"motion\":6,\"light\":1},{\"timestampSeconds\":1617145260,\"confidence\":35,\"motion\":3,\"light\":1}]"
        val sleepListFile = "[{\"timestampSeconds\":1617145620,\"confidence\":84,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617145980,\"confidence\":92,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617146340,\"confidence\":92,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617146700,\"confidence\":94,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617147060,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617147420,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617147780,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617148140,\"confidence\":91,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617148500,\"confidence\":90,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617148860,\"confidence\":91,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617149220,\"confidence\":83,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617149580,\"confidence\":89,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617149940,\"confidence\":91,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617150300,\"confidence\":84,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617150660,\"confidence\":84,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617151020,\"confidence\":87,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617151320,\"confidence\":90,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617151680,\"confidence\":95,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617152040,\"confidence\":94,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617152400,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617152760,\"confidence\":94,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617153120,\"confidence\":83,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617153480,\"confidence\":84,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617153840,\"confidence\":80,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617154200,\"confidence\":87,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617154560,\"confidence\":89,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617154920,\"confidence\":90,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617155280,\"confidence\":86,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617155640,\"confidence\":85,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617156000,\"confidence\":76,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617156360,\"confidence\":89,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617156720,\"confidence\":87,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617157080,\"confidence\":83,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617157440,\"confidence\":90,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617157800,\"confidence\":90,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617158160,\"confidence\":83,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617158520,\"confidence\":84,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617158880,\"confidence\":87,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617159240,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617159600,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617159960,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617160320,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617160680,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617161040,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617161400,\"confidence\":91,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617161760,\"confidence\":90,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617162120,\"confidence\":83,\"motion\":4,\"light\":1},{\"timestampSeconds\":1617162480,\"confidence\":90,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617162780,\"confidence\":88,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617163140,\"confidence\":91,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617163500,\"confidence\":91,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617163860,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617164220,\"confidence\":95,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617164580,\"confidence\":23,\"motion\":4,\"light\":3},{\"timestampSeconds\":1617164940,\"confidence\":59,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617165300,\"confidence\":69,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617165660,\"confidence\":92,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617166020,\"confidence\":92,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617166380,\"confidence\":92,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617166740,\"confidence\":91,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617167100,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617167460,\"confidence\":97,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617167820,\"confidence\":97,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617168180,\"confidence\":93,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617168540,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617168900,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617169260,\"confidence\":97,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617169620,\"confidence\":93,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617169980,\"confidence\":94,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617170340,\"confidence\":92,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617170700,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617171060,\"confidence\":93,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617171420,\"confidence\":94,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617171720,\"confidence\":94,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617172080,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617172440,\"confidence\":93,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617172800,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617173160,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617173520,\"confidence\":97,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617173880,\"confidence\":97,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617174240,\"confidence\":93,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617174600,\"confidence\":94,\"motion\":3,\"light\":1},{\"timestampSeconds\":1617174960,\"confidence\":92,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617175320,\"confidence\":93,\"motion\":1,\"light\":1},{\"timestampSeconds\":1617175680,\"confidence\":97,\"motion\":1,\"light\":1}]"//,{\"timestampSeconds\":1617176040,\"confidence\":96,\"motion\":2,\"light\":1},{\"timestampSeconds\":1617176400,\"confidence\":93,\"motion\":3,\"light\":1}]"//,{\"timestampSeconds\":1617176760,\"confidence\":93,\"motion\":1,\"light\":1}]"//,{\"timestampSeconds\":1617177120,\"confidence\":94,\"motion\":2,\"light\":1}]"//,{\"timestampSeconds\":1617177480,\"confidence\":96,\"motion\":1,\"light\":1}]"//,{\"timestampSeconds\":1617177840,\"confidence\":95,\"motion\":1,\"light\":1}]"
        val modelFile = "{\"valuesAwake\":{\"light\":{\"Average\":2.47058821,\"Factor\":1.2352941,\"Max\":6.0,\"Median\":2.0,\"Min\":1.0},\"motion\":{\"Average\":5.23529434,\"Factor\":0.872549057,\"Max\":6.0,\"Median\":6.0,\"Min\":1.0},\"sleep\":{\"Average\":14.0588236,\"Factor\":2.34313726,\"Max\":50.0,\"Median\":6.0,\"Min\":1.0}},\"valuesDiff\":{\"light\":{\"Average\":1.4470588,\"Factor\":0.2117647,\"Max\":3.0,\"Median\":1.0,\"Min\":0.0},\"motion\":{\"Average\":3.30588245,\"Factor\":-1.05686271,\"Max\":2.0,\"Median\":5.0,\"Min\":0.0},\"sleep\":{\"Average\":-75.4588242,\"Factor\":1.37011933,\"Max\":-47.0,\"Median\":-86.0,\"Min\":-22.0}},\"valuesSleep\":{\"light\":{\"Average\":1.02352941,\"Factor\":1.02352941,\"Max\":3.0,\"Median\":1.0,\"Min\":1.0},\"motion\":{\"Average\":1.92941177,\"Factor\":1.92941177,\"Max\":4.0,\"Median\":1.0,\"Min\":1.0},\"sleep\":{\"Average\":89.51765,\"Factor\":0.9730179,\"Max\":97.0,\"Median\":92.0,\"Min\":23.0}}}"
        //endregion

        val awakeList = gson.fromJson(awakeListFile, Array<SleepApiRawDataEntity>::class.java).asList()
        val sleepList = gson.fromJson(sleepListFile, Array<SleepApiRawDataEntity>::class.java).asList()
        val correctModel = gson.fromJson(modelFile, SleepModel::class.java)

        val calculatedModel = SleepModel.calculateModel(awakeList, sleepList)

        // ...then the result should be the expected one.
        assertThat(calculatedModel, equalTo(correctModel))
    }

}